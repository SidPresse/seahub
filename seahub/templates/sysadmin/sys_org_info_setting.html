{% extends "sysadmin/sys_org_info_base.html" %}
{% load i18n seahub_tags %}
{% load url from future %}

{% block right_panel %}
<div class="tabnav">
    <ul class="tabnav-tabs">
        <li class="tabnav-tab"><a href="{% url 'sys_org_info_user' org.org_id %}">{% trans "Members" %}</a></li>
        <li class="tabnav-tab"><a href="{% url 'sys_org_info_group' org.org_id %}">{% trans "Groups" %}</a></li>
        <li class="tabnav-tab"><a href="{% url 'sys_org_info_library' org.org_id %}">{% trans "Libraries" %}</a></li>
        <li class="tabnav-tab tabnav-tab-cur"><a href="{% url 'sys_org_info_setting' org.org_id %}">{% trans "Settings" %}</a></li>
    </ul>
</div>

<div class="setting-item">
    <h3>{% trans "Rename Organization" %}</h3>
    <form action="{% url 'sys_org_rename' org.org_id %}" method="post">{% csrf_token %}
        <label>{% trans "New Name" %}</label></br>
        <input type="text" name="new_name" class="input" value="{{ org.org_name }}"/></br>
        <input type="submit" value="{% trans "Submit" %}" class="submit" />
    </form>

    {% if org_member_quota %}
    <h3>{% trans "Limit Organization User Number" %}</h3>
    <form id="org_member_quota" action="" method="post" class="form">{% csrf_token %}
        <label>{% trans "Max User Number" %}</label></br>
        <input type="text" name="member_quota" class="input" value="{{ org_member_quota }}"/></br>
        <p class="error hide"></p>
        <input type="submit" value="{% trans "Submit" %}" class="submit" />
    </form>
    {% endif %}

    {% if org_trial_days %}
    <h3>{% trans "Set Trial Days" %}</h3>
    <form id="org_trial_days" action="" method="post" class="form">{% csrf_token %}
        <label>{% trans "Trial Days ( -1 for no limit )" %}</label></br>
        <input type="text" name="trial_days" class="input" value="{{ org_trial_days }}"/></br>
        <p class="error hide"></p>
        <input type="submit" value="{% trans "Submit" %}" class="submit" />
    </form>
    {% endif %}

</div>

{% endblock %}

{% block extra_script %}
<script type="text/javascript">
{% include 'sysadmin/sys_org_set_quota_js.html' %}

{% if org_member_quota %}
$('#org_member_quota').submit(function() {
    var form = $(this),
        form_id = form.attr('id'),
        member_quota = $('[name="member_quota"]', form).val(),
        submit_btn = $('input[type="submit"]', form);

    if (!$.trim(member_quota)) {
        apply_form_error(form_id, "{% trans "Please input a number" %}");
        return false;
    } else if (isNaN(member_quota)) {
        apply_form_error(form_id, "{% trans "Input should be a number" %}");
        return false;
    } else if (trial_days < -1 || trial_days == 0) {
        apply_form_error(form_id, "{% trans "Input number should be greater than 0 or -1 ( for no limit )" %}");
        return false;
    }

    $.ajax({
        url: '{% url 'sys_org_set_member_quota' org.org_id %}',
        type: 'POST',
        cache: false,
        dataType: 'json',
        beforeSend: prepareCSRFToken,
        data: {
            'member_quota': member_quota
        },
        success: function(data) {
            if (data['success']) {
                location.reload(true);
            }
        },
        error: ajaxErrorHandler
    });
    return false;
});
{% endif %}

{% if org_trial_days %}
$('#org_trial_days').submit(function() {
    var form = $(this),
        form_id = form.attr('id'),
        trial_days = $('[name="trial_days"]', form).val(),
        submit_btn = $('input[type="submit"]', form);

    if (!$.trim(trial_days)) {
        apply_form_error(form_id, "{% trans "Please input a number" %}");
        return false;
    } else if (isNaN(trial_days)) {
        apply_form_error(form_id, "{% trans "Input should be a number" %}");
        return false;
    } else if (trial_days < -1 || trial_days == 0) {
        apply_form_error(form_id, "{% trans "Input number should be greater than 0 or -1 ( for no limit )" %}");
        return false;
    }

    $.ajax({
        url: '{% url 'sys_org_set_trial_days' org.org_id %}',
        type: 'POST',
        cache: false,
        dataType: 'json',
        beforeSend: prepareCSRFToken,
        data: {
            'trial_days': trial_days
        },
        success: function(data) {
            if (data['success']) {
                location.reload(true);
            }
        },
        error: ajaxErrorHandler
    });
    return false;
});
{% endif %}
</script>
{% endblock %}
